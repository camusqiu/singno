<!DOCTYPE html>
<html>
  <head>
    <title>金腾盈后台管理系统 - 资讯管理</title>
    <style type="text/css">
      .active
      {
          color: red;
      }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8" />

    <link rel="icon" type="image/ico" href="http://tattek.com/minimal/assets/images/favicon.ico" />
    <link rel="stylesheet" href="css/global.css" /> 
<link type="text/css" rel="stylesheet" media="all" href="assets/vendor/mmenu/css/jquery.mmenu.all.css" />  
    <link rel="stylesheet" href="../assets/vendor/chosen/css/chosen.min.css">
    <link rel="stylesheet" href="../assets/vendor/chosen/css/chosen-bootstrap.css">
    <link rel="stylesheet" href="../assets/vendor/datepicker/css/bootstrap-datetimepicker.css">
  </head>
  <body class="bg-1">
    <div class="mask"><div id="loader"></div></div>
 

    <!-- Wrap all page content here -->
    <div id="wrap">

      


      <!-- Make page fluid -->
      <div class="row">
        


        <!-- Fixed navbar -->
        <div class="navbar navbar-default navbar-fixed-top navbar-transparent-black mm-fixed-top" role="navigation" id="navbar">
          


          <!-- Branding -->
          <div class="navbar-header col-md-2">
            <a class="navbar-brand" href="index.html">
              <strong>MIN</strong>IMAL
            </a>
            <div class="sidebar-collapse">
              <a href="#">
                <i class="fa fa-bars"></i>
              </a>
            </div>
          </div>
          <!-- Branding end -->


          <!-- .nav-collapse -->
          <div class="navbar-collapse">
                        
            <!-- Page refresh -->
            <ul class="nav navbar-nav refresh">
              <li class="divided">
                <a href="#" class="page-refresh"><i class="fa fa-refresh"></i></a>
              </li>
            </ul>
            <!-- /Page refresh -->

            <!-- Search -->
            <div class="search" id="main-search">
              <i class="fa fa-search"></i> <input type="text" placeholder="Search...">
            </div>
            <!-- Search end -->

            <!-- Quick Actions -->
            <ul class="nav navbar-nav quick-actions">
              
              <li class="dropdown divided">
                
                <a class="dropdown-toggle button" data-toggle="dropdown" href="#">
                  <i class="fa fa-tasks"></i>
                  <span class="label label-transparent-black">2</span>
                </a>

                <ul class="dropdown-menu wide arrow nopadding bordered">
                  <li><h1>You have <strong>2</strong> new tasks</h1></li>
                  <li>
                    <a href="#">
                      <div class="task-info">
                        <div class="desc">Layout</div>
                        <div class="percent">80%</div>
                      </div>
                      <div class="progress progress-striped progress-thin">
                        <div class="progress-bar progress-bar-green" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                          <span class="sr-only">40% Complete (success)</span>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <div class="task-info">
                        <div class="desc">Schemes</div>
                        <div class="percent">15%</div>
                      </div>
                      <div class="progress progress-striped active progress-thin">
                        <div class="progress-bar progress-bar-cyan" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 15%">
                          <span class="sr-only">45% Complete</span>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <div class="task-info">
                        <div class="desc">Forms</div>
                        <div class="percent">5%</div>
                      </div>
                      <div class="progress progress-striped progress-thin">
                        <div class="progress-bar progress-bar-orange" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 5%">
                          <span class="sr-only">5% Complete (warning)</span>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <div class="task-info">
                        <div class="desc">JavaScript</div>
                        <div class="percent">30%</div>
                      </div>
                      <div class="progress progress-striped progress-thin">
                        <div class="progress-bar progress-bar-red" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 30%">
                          <span class="sr-only">30% Complete (danger)</span>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <div class="task-info">
                        <div class="desc">Dropdowns</div>
                        <div class="percent">60%</div>
                      </div>
                      <div class="progress progress-striped progress-thin">
                        <div class="progress-bar progress-bar-amethyst" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                          <span class="sr-only">60% Complete</span>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li><a href="#">Check all tasks <i class="fa fa-angle-right"></i></a></li>
                </ul>

              </li>

              <li class="dropdown divided">
                
                <a class="dropdown-toggle button" data-toggle="dropdown" href="#">
                  <i class="fa fa-envelope"></i>
                  <span class="label label-transparent-black">1</span>
                </a>

                <ul class="dropdown-menu wider arrow nopadding messages">
                  <li><h1>You have <strong>1</strong> new message</h1></li>
                  <li>
                    <a class="cyan" href="#">
                      <div class="profile-photo">
                        <img src="assets/images/ici-avatar.jpg" alt />
                      </div>
                      <div class="message-info">
                        <span class="sender">Ing. Imrich Kamarel</span>
                        <span class="time">12 mins</span>
                        <div class="message-content">Duis aute irure dolor in reprehenderit in voluptate velit esse cillum</div>
                      </div>
                    </a>
                  </li>

                  <li>
                    <a class="green" href="#">
                      <div class="profile-photo">
                        <img src="assets/images/arnold-avatar.jpg" alt />
                      </div>
                      <div class="message-info">
                        <span class="sender">Arnold Karlsberg</span>
                        <span class="time">1 hour</span>
                        <div class="message-content">Lorem ipsum dolor sit amet, consectetur adipisicing elit</div>
                      </div>
                    </a>
                  </li>

                  <li>
                    <a href="#">
                      <div class="profile-photo">
                        <img src="assets/images/profile-photo.jpg" alt />
                      </div>
                      <div class="message-info">
                        <span class="sender">John Douey</span>
                        <span class="time">3 hours</span>
                        <div class="message-content">Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia</div>
                      </div>
                    </a>
                  </li>

                  <li>
                    <a class="red" href="#">
                      <div class="profile-photo">
                        <img src="assets/images/peter-avatar.jpg" alt />
                      </div>
                      <div class="message-info">
                        <span class="sender">Peter Kay</span>
                        <span class="time">5 hours</span>
                        <div class="message-content">Ut enim ad minim veniam, quis nostrud exercitation</div>
                      </div>
                    </a>
                  </li>

                  <li>
                    <a class="orange" href="#">
                      <div class="profile-photo">
                        <img src="assets/images/george-avatar.jpg" alt />
                      </div>
                      <div class="message-info">
                        <span class="sender">George McCain</span>
                        <span class="time">6 hours</span>
                        <div class="message-content">Lorem ipsum dolor sit amet, consectetur adipisicing elit</div>
                      </div>
                    </a>
                  </li>


                  <li class="topborder"><a href="#">Check all messages <i class="fa fa-angle-right"></i></a></li>
                </ul>

              </li>

              <li class="dropdown divided">
                
                <a class="dropdown-toggle button" data-toggle="dropdown" href="#">
                  <i class="fa fa-bell"></i>
                  <span class="label label-transparent-black">3</span>
                </a>

                <ul class="dropdown-menu wide arrow nopadding bordered">
                  <li><h1>You have <strong>3</strong> new notifications</h1></li>
                  
                  <li>
                    <a href="#">
                      <span class="label label-green"><i class="fa fa-user"></i></span>
                      New user registered.
                      <span class="small">18 mins</span>
                    </a>
                  </li>

                  <li>
                    <a href="#">
                      <span class="label label-red"><i class="fa fa-power-off"></i></span>
                      Server down.
                      <span class="small">27 mins</span>
                    </a>
                  </li>

                  <li>
                    <a href="#">
                      <span class="label label-orange"><i class="fa fa-plus"></i></span>
                      New order.
                      <span class="small">36 mins</span>
                    </a>
                  </li>

                  <li>
                    <a href="#">
                      <span class="label label-cyan"><i class="fa fa-power-off"></i></span>
                      Server restared.
                      <span class="small">45 mins</span>
                    </a>
                  </li>

                  <li>
                    <a href="#">
                      <span class="label label-amethyst"><i class="fa fa-power-off"></i></span>
                      Server started.
                      <span class="small">50 mins</span>
                    </a>
                  </li>

                   <li><a href="#">Check all notifications <i class="fa fa-angle-right"></i></a></li>
                </ul>

              </li>

              <li class="dropdown divided user" id="current-user">
                <div class="profile-photo">
                  <img src="assets/images/profile-photo.jpg" alt />
                </div>
                <a class="dropdown-toggle options" data-toggle="dropdown" href="#">
                  John Douey <i class="fa fa-caret-down"></i>
                </a>
                
                <ul class="dropdown-menu arrow settings">

                  <li>
                    
                    <h3>Backgrounds:</h3>
                    <ul id="color-schemes">
                      <li><a href="#" class="bg-1"></a></li>
                      <li><a href="#" class="bg-2"></a></li>
                      <li><a href="#" class="bg-3"></a></li>
                      <li><a href="#" class="bg-4"></a></li>
                      <li><a href="#" class="bg-5"></a></li>
                      <li><a href="#" class="bg-6"></a></li>
                    </ul>

                    <div class="form-group videobg-check">
                      <label class="col-xs-8 control-label">Video BG</label>
                      <div class="col-xs-4 control-label">
                        <div class="onoffswitch greensea small">
                          <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="videobg-check">
                          <label class="onoffswitch-label" for="videobg-check">
                            <span class="onoffswitch-inner"></span>
                            <span class="onoffswitch-switch"></span>
                          </label>
                        </div>
                      </div>
                    </div>

                  </li>

                  <li class="divider"></li>

                  <li>
                    <a href="#"><i class="fa fa-user"></i> Profile</a>
                  </li>

                  <li>
                    <a href="#"><i class="fa fa-calendar"></i> Calendar</a>
                  </li>

                  <li>
                    <a href="#"><i class="fa fa-envelope"></i> Inbox <span class="badge badge-red" id="user-inbox">3</span></a>
                  </li>

                  <li class="divider"></li>

                  <li>
                    <a href="#"><i class="fa fa-power-off"></i> Logout</a>
                  </li>
                </ul>
              </li>

              <li>
                <a href="#mmenu"><i class="fa fa-comments"></i></a>
              </li>
            </ul>
            <!-- /Quick Actions -->



            <!-- Sidebar -->
<ul class="nav navbar-nav side-nav" id="sidebar">
  
  <li class="collapsed-content"> 
    <ul>
      <li class="search"><!-- Collapsed search pasting here at 768px --></li>
    </ul>
  </li>

  <li class="navigation" id="navigation">
    <a href="#" class="sidebar-toggle" data-toggle="#navigation">功能导航</a>
    
    <ul class="menu">
      
      <li class="dropdown" id="menu_login">
        <a href="index.html" class="dropdown-toggle">
           后台首页 <b class="fa fa-plus dropdown-plus hide"></b>
        </a>
      </li>

      <li class="dropdown active" id="menu_info">
        <a href="info.html" class="dropdown-toggle">
           资讯编辑 <b class="fa fa-plus dropdown-plus hide"></b>
        </a>
      </li>


      <li class="dropdown" id="menu_homepage">
        <a href="homepage.html" class="dropdown-toggle">
          首页推荐 <b class="fa fa-plus dropdown-plus hide"></b>
        </a>
      </li>


      <li class="dropdown" id="menu_postbar">
        <a href="postbar.html" class="dropdown-toggle">
           吧贴管理 <b class="fa fa-plus dropdown-plus hide"></b>
        </a>
      </li>

       <li class="dropdown" id="menu_user">
        <a href="user.html" class="dropdown-toggle">
          用户管理 <b class="fa fa-plus dropdown-plus hide"></b>
        </a>
      </li>



      <li class="dropdown" id="menu_infoadmin">
        <a href="infoadmin.html" class="dropdown-toggle">
           资讯管理 <b class="fa fa-plus dropdown-plus hide"></b>
        </a>
      </li>



      <li class="dropdown" id="menu_ability">
        <a href="abilitytag.html" class="dropdown-toggle">
          用户标签 <b class="fa fa-plus dropdown-plus hide"></b>
        </a>
      </li>



      <li class="dropdown" id="menu_stockbar">
        <a href="stockbar.html" class="dropdown-toggle">
           股吧管理 <b class="fa fa-plus dropdown-plus hide"></b>
        </a>
      </li>

      <li class="dropdown" id="menu_stockbar">
        <a href="stockbarHYGN.html" class="dropdown-toggle">
           行业概念 <b class="fa fa-plus dropdown-plus hide"></b>
        </a>
      </li>

      
      <li class="dropdown" id="menu_report">
        <a href="report.html" class="dropdown-toggle">
           举报管理 <b class="fa fa-plus dropdown-plus hide"></b>
        </a>
      </li>


      <li class="dropdown" id="menu_drawmoney">
        <a href="drawmoney.html" class="dropdown-toggle">
           提款管理 <b class="fa fa-plus dropdown-plus hide"></b>
        </a>
      </li>

     
     <li class="dropdown" id="menu_fund">
        <a href="fundmanagement.html" class="dropdown-toggle">
           资金管理 <b class="fa fa-plus dropdown-plus hide"></b>
        </a>
      </li>

      <li class="dropdown" id="menu_stockdata">
        <a href="stockdata.html" class="dropdown-toggle">
           股票数据 <b class="fa fa-plus dropdown-plus hide"></b>
        </a>
      </li>

      <li class="dropdown" id="menu_app">
        <a href="appmanagement.html" class="dropdown-toggle">
           App管理 <b class="fa fa-plus dropdown-plus hide"></b>
        </a>
      </li>

    </ul>

  </li>

</ul>
<!-- Sidebar end -->





          </div>
          <!--/.nav-collapse -->





        </div>
        <!-- Fixed navbar end -->




        
        <!-- Page content -->
        <div id="content" class="col-md-12">
          

          <div class="pageheader">

            <h2><i class="fa fa-puzzle-piece" style="line-height: 48px;padding-left: 5px;"></i> 资讯管理 <span>管理从网上抓取的资讯</span></h2>

          </div>



          <!-- content main container -->
          <div class="main">




            <!-- row -->
            <div class="row">

              <div class="col-md-12">


                <!-- tile -->
                <section class="tile color transparent-black">

                  <!-- tile header -->
                  <div class="tile-header">
                    <div class="form-group" style="width:300px;height:10px;">
                      <label for="datepicker" class="col-sm-4 control-label">选择日期</label>
                      <div class="col-sm-8">
                        <input type="text" class="form-control input-sm" id="datepicker">
                      </div>
                    </div>
                    <div class="search" style="position: absolute;top: 10px;right: 15px;">
                      <input type="text" name="searchTitle" placeholder="请输入标题/内容">
                      <button type="button" data-click="searchType" data-value="1" class="btn btn-default">搜索</button>
                      <button type="button" data-click="edit" data-value="1" class="btn btn-default">+</button>
                    </div>
                  </div>
                  <!-- /tile header -->

                  <!-- tile widget -->
                  <div class="tile-widget bg-transparent-black-2">
                    <div class="row">
                      
                      <div class="col-sm-4 col-xs-6">
                        <div class="input-group table-options">
                          <select class="chosen-select form-control">
                            <option value="">全部</option>
                            <option value="2">公告</option>
                            <option value="3">要闻</option>
                            <option value="4">分析</option>
                            <option value="5">个股</option>
                          </select>
                        </div>
                      </div>
                      
                      <div class="col-sm-8 col-xs-6 text-right">
                        
                         <div class="btn-group btn-group-xs table-options">
                          <button type="button" data-click="selectType" data-value="0" class="btn btn-primary">未发布</button>
                          <button type="button" data-click="selectType" data-value="1"  class="btn btn-default">已发布</button>
                          <button type="button" data-click="selectType" data-value="2"  class="btn btn-default">已编辑未发布</button>
                          <button type="button" data-click="selectType" data-value="3" class="btn btn-default">发布回退</button>
                          <button type="button" data-click="selectType" data-value="4" class="btn btn-default">发布修改中</button>
                          <button type="button" data-click="selectType" data-value="5" class="btn btn-default">已忽略</button>
                        </div>

                      </div>

                    </div>
                  </div>
                  <!-- /tile widget -->



                  <!-- tile body -->
                  <div class="tile-body nopadding" id="mod_info"></div>
                  <!-- /tile body -->


                  <!-- tile footer -->
                  <div class="tile-footer bg-transparent-black-2 rounded-bottom-corners">
                    <div class="row">  
                      <div class="text-left sm-left">
                        <button type="button" data-click="allselect" data-value="1" class="btn btn-default">全选</button>
                        <button type="button" data-click="allignoe" data-value="1" class="btn btn-default">批量忽略</button>
                      </div>
                    </div>
                    <div class="row">  
                      <div class="col-sm-12 text-center sm-center">
                        <ul class="pagination pagination-xs nomargin pagination-custom">
                        </ul>
                      </div>
                    </div>
                  </div>
                  <!-- /tile footer -->
                  
                


                </section>
                <!-- /tile -->

              </div>
            </div>
            <!-- /row -->
          


          </div>
          <!-- /content container -->






        </div>
        <!-- Page content end -->

      </div>
      <!-- Make page fluid-->




    </div>
    <!-- Wrap all page content end -->

<div class="modal fade" id="edit_modal" tabindex="-1" role="dialog" aria-labelledby="modalDialogLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog" style="width: 80%;margin-right:10%; margin-left:10%;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">关闭</button>
        <h3 class="modal-title" id="modalDialogLabel"><a href="" target="blank">资讯详情</a></h3>
      </div>
      <div class="modal-body">
        <form class="form-horizontal" role="form">
                      
          <div class="form-group">
            <label for="edit_title" class="col-sm-1 control-label">标题</label>
            <div class="col-sm-11">
              <input type="text" class="form-control" name="title" id="edit_title">
            </div>
          </div>

          <div class="form-group">
            <label for="edit_source" class="col-sm-1 control-label">来源</label>
            <div class="col-sm-11">
              <input type="text" class="form-control" name="source" id="edit_source">
            </div>
          </div>

          <div class="form-group">
            <label class="col-sm-1 control-label">类型</label>
            <div class="col-sm-11">
              <div class="radio radio-transparent" style="display:inline-block;">
                <input type="radio" name="type" id="edit_type_2" value="2">
                <label for="edit_type_2">公告</label>
              </div>
              <div class="radio radio-transparent" style="display:inline-block;">
                <input type="radio" name="type" id="edit_type_3" value="3">
                <label for="edit_type_3">要闻</label>
              </div>
              <div class="radio radio-transparent" style="display:inline-block;">
                <input type="radio" name="type" id="edit_type_4" value="4">
                <label for="edit_type_4">分析</label>
              </div>
              <div class="radio radio-transparent" style="display:inline-block;">
                <input type="radio" name="type" id="edit_type_5" value="5">
                <label for="edit_type_5">个股</label>
              </div>
            </div>
          </div>

          <div class="form-group" id="addurl">
            <label for="edit_url" class="col-sm-1 control-label">网址</label>
            <div class="col-sm-11">
              <input type="text" class="form-control" name="url" id="edit_url">
            </div>
          </div>

           <!--div class="form-group">
            <label for="edit_content" class="col-sm-1 control-label">内容</label>
            <div class="col-sm-11">
              <textarea name="content" style="width:100%; height:400px" id="edit_content">
              </textarea>
            </div>
          </div-->

          <!--div class="tile-body nopadding"-->
          <div class="form-group">
          <label for="edit_content" class="col-sm-1 control-label">内容</label>
            <div class="col-sm-11">
              <!--textarea name="content" style="width:100%; height:400px" id="edit_content"-->
              <div class="form-control" name="content" id="edit_content"></div>
            </div>
          </div>

          <div class="form-group">
            <label class="col-sm-1 control-label">精华设置</label>
            <div class="col-sm-11">
              <div class="checkbox check-transparent" style="display:inline-block;">
                  <input type="checkbox" value="1" name="index_recom_state" id="edit_index_recom_state">
                  <label for="edit_index_recom_state">首页推荐</label>
                </div>
                <div class="checkbox check-transparent" style="display:inline-block;">
                  <input type="checkbox" value="1" name="essential_state" id="edit_essential_state">
                  <label for="edit_essential_state">精华</label>
                </div>
                <div class="checkbox check-transparent" style="display:inline-block;">
                  <input type="checkbox" name="sticky_state" value="1" id="edit_sticky_state">
                  <label for="edit_sticky_state">置顶</label>
                </div>
            </div>
          </div>

          <div class="form-group">
            <label for="strbar_id" class="col-sm-1 control-label">个股关联</label>
            <div class="col-sm-11">
              <input type="text" class="form-control" name="strbar_id" id="edit_strbar_id" placeholder="输入股票代码，多个以英文逗号 / 分隔">
              <ul id="search_result_list" class="search-show hide"></ul>
            </div>
          </div>

          <div class="form-group">
            <label for="zh_strbar_id" class="col-sm-1 control-label">综合股吧</label>
            <div class="col-sm-11">
            <!-- 标签 -->
              <div class="stock-bar">
              </div>  
            </div>
          </div>

          <div class="form-group">
            <label for="input04" class="col-sm-1 control-label">股吧关联</label>
            <div class="col-sm-11">
            <!-- 标签 -->
              <div class="stock-tag">
                <!--h5>沪深：</h5> 
                <div class="checkbox check-transparent" style="display:inline-block;">
                  <input type="checkbox" value="1" name="index_recom_state" id="opt01">
                  <label for="opt01">股吧名字</label-->
                </div>

            </div>
          </div>

          <div class="form-group form-footer">
            <div class="col-sm-offset-4 col-sm-8">
              <button type="button" data-click="ignoreType" data-value="2"  class="btn btn-default">忽略</button>
              <button type="button" data-click="saveType" data-value="0"  class="btn btn-default">保存</button>
              <button type="button" data-click="releaseType" data-value="1"  class="btn btn-default">发布</button>
            </div>
          </div>



        </form>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>



    <section class="videocontent" id="video"></section>

<script type="text/tpl" id="tpl_info">
  
  <table class="table table-bordered table-sortable">
    <thead>
      <tr>
        <th>多选</th>
        <th>类型</th>
        <th>时间</th>
        <th>标题</th>
        <th>来源</th>
        <th style="width:140px;">操作</th>
      </tr>
    </thead>
    <tbody>
      {{#list}}
      <tr style="{{color}}">
        <td><div><input type="checkbox" value="" name="is_select" id="{{id}}"></div></td>
        <td>{{typeName}}</td>
        <td>{{ctime}}</td>
        <td>
          <a href="{{{url}}}" target="_blank" title="{{title}}"  style="{{color}}">{{title}}</a>
        </td>
        <td>{{source}}</td>
        <td>
          <a data-click="ignore" data-id="{{id}}" style="{{color}}" href="#">忽略</a>&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
          <a data-click="edit" data-id="{{id}}" style="{{color}}" href="#">编辑</a>
        </td>
      </tr>
      {{/list}}
    </tbody>
  </table>

</script>

<script type="text/tpl" id="tpl_info_release">
  
  <table class="table table-bordered table-sortable">
    <thead>
      <tr>
        <th>类型</th>
        <th>时间</th>
        <th>标题</th>
        <th>来源</th>
        <th style="width:140px;">操作</th>
      </tr>
    </thead>
    <tbody>
      {{#list}}
      <tr style="{{color}}">
        <td>{{typeName}}</td>
        <td>{{ctime}}</td>
        <td>
          <a href="{{{url}}}" target="_blank" title="{{title}}"  style="{{color}}">{{title}}</a>
        </td>
        <td>{{source}}</td>
        <td>
          <a data-click="ignore" data-id="{{id}}" style="{{color}}" href="#">取消发布</a>&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
          <a data-click="edit" data-id="{{id}}" style="{{color}}" href="#">编辑</a>
        </td>
      </tr>
      {{/list}}
    </tbody>
  </table>

</script>

<script type="text/tpl" id="tpl_info_ignore">
  
  <table class="table table-bordered table-sortable">
    <thead>
      <tr>
        <th>类型</th>
        <th>时间</th>
        <th>标题</th>
        <th>来源</th>
        <th style="width:140px;">操作</th>
      </tr>
    </thead>
    <tbody>
      {{#list}}
      <tr>
        <td>{{typeName}}</td>
        <td>{{ctime}}</td>
        <td>
          <a href="{{{url}}}" target="_blank" title="{{title}}" style="{{color}}">{{title}}</a>
        </td>
        <td>{{source}}</td>
        <td>
          <a data-click="ignore" data-id="{{id}}" style="{{color}}" href="#">取消忽略</a>&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
          <a data-click="edit" data-id="{{id}}" style="{{color}}" href="#">编辑</a>
        </td>
      </tr>
      {{/list}}
    </tbody>
  </table>

</script>



    <script src="js/core.js"></script> 
    <script src="js/extend.js"></script> 
    <script src="assets/vendor/mmenu/js/jquery.mmenu.min.js"></script>
    <script src="assets/vendor/sparkline/jquery.sparkline.min.js"></script>
    <script src="assets/vendor/nicescroll/jquery.nicescroll.min.js"></script>
    <script src="/assets/vendor/chosen/chosen.jquery.min.js"></script>
    <script src="/assets/vendor/momentjs/moment-with-langs.min.js"></script>
    <script src="/assets/vendor/datepicker/bootstrap-datetimepicker.min.js"></script>
    <script src="/assets/vendor/pagination/pagination.js"></script>
    <script src="/assets/js/vendor/summernote/summernote.min.js"></script>

    <script>
+function() {
  document.domain = 'richba.com';

  var queryConfig = {
    type: '',
    state: 0,
    ctime: _.dateFormat(new Date(), 'yyyy-MM-dd'),
    curpage: 1,
    pagenum: 10,
    user_id: ''
  };

  var mapToType = {
    '2': '公告',
    '3': '要闻',
    '4': '分析',
    '5': '个股'
  };

  var saveData = {};

  var saveDataTemp = {
    strbar_id_ZH : '',
    strbar_id : '',
    updateTag : 0
  };

  var strtag_id_flag = {
    HY_Astock : 0,
    HY_HKstock : 0,
    HY_USstock : 0,
    GN_Astock : 0,
    GN_HKstock : 0,
    GN_USstock : 0
  };

  var newsData = {
    code: "",
    content: "",
    ctime: "",
    essential_state: "",
    id: "",
    index_recom_state: "",
    modify_time: "",
    source: "",
    state: "",
    sticky_state: "",
    strbar_id: "",
    strtag_id: "",
    time: "",
    title: "",
    type: "",
    typeName: "",
    url: "",
    user_id: ""
  }

  var dataList = [];

  var searchKey = '';
  var $container = $('#mod_info');
  var BASE_URL = '/stock/index.php/Home/';

  var editor = null;

  var allSelectTag = 0;

  $(function(){

      //check all checkboxes
      $('table thead input[type="checkbox"]').change(function () {
        $(this).parents('table').find('tbody input[type="checkbox"]').prop('checked', $(this).prop('checked'));
      });

      // sortable table
      $('.table.table-sortable th.sortable').click(function() {
        var o = $(this).hasClass('sort-asc') ? 'sort-desc' : 'sort-asc';
        $(this).parents('table').find('th.sortable').removeClass('sort-asc').removeClass('sort-desc');
        $(this).addClass(o);
      });

      //chosen select input
      $(".chosen-select").chosen({disable_search_threshold: 10}).on('change', function () {
        var $this = $(this);
        queryConfig.type = $this.val();

        loadData();
      });

      //check toggling
      $('.check-toggler').on('click', function(){
        $(this).toggleClass('checked');
      });

      var strCookie = document.cookie;
      var arrayCookie = strCookie.split(";");
      var strData = "", currentTime = "";
      for(var i = 0; i < arrayCookie.length; i++){
        var valdata = "data=";
        if(arrayCookie[i].indexOf("data") >= 0){
          currentTime = arrayCookie[i].substr(valdata.length+arrayCookie[i].indexOf("data"), arrayCookie[i].length);
          strData = arrayCookie[i];
        }
      }

      if(!currentTime){
        currentTime = queryConfig.ctime;
      }else{
        queryConfig.ctime = currentTime;
      }
      
      //var currentTime = queryConfig.ctime;

      $('#datepicker').datepicker({
        format: "yyyy-mm-dd",
        language: "zh-CN",
        todayHighlight: true,
        autoclose: true
      }).val(currentTime)
      .on('changeDate', function (ev) {
        queryConfig.ctime = $(ev.target).val();
        if(document.cookie.indexOf("data") >= 0){
          document.cookie ="data="+queryConfig.ctime;
        }
        
      
        loadData();
      });

      M.controller.add('stockType_HY_Astock', function (ev) {
        ev.preventDefault();
        if(strtag_id_flag.HY_Astock == 1){
          $("#HY_Astock").hide();
          strtag_id_flag.HY_Astock = 0;
        }else{
          $("#HY_Astock").show();
          $("#HY_HKstock").hide();
          $("#HY_USstock").hide();
          $("#GN_Astock").hide();
          $("#GN_HKstock").hide();
          $("#GN_USstock").hide();
          strtag_id_flag.HY_Astock = 1;
          strtag_id_flag.HY_HKstock = 0;
          strtag_id_flag.HY_USstock = 0;
          strtag_id_flag.GN_Astock = 0;
          strtag_id_flag.GN_HKstock = 0;
          strtag_id_flag.GN_USstock = 0;
        }
      });
      M.controller.add('stockType_HY_HKstock', function (ev) {
        ev.preventDefault();
        if(strtag_id_flag.HY_HKstock == 1){
          $("#HY_HKstock").hide();
          strtag_id_flag.HY_HKstock = 0;
        }else{
          $("#HY_HKstock").show();
          $("#HY_Astock").hide();
          $("#HY_USstock").hide();
          $("#GN_HKstock").hide();
          $("#GN_Astock").hide();
          $("#GN_USstock").hide();
          strtag_id_flag.HY_HKstock = 1;
          strtag_id_flag.HY_Astock = 0;
          strtag_id_flag.HY_USstock = 0;
          strtag_id_flag.GN_HKstock = 0;
          strtag_id_flag.GN_Astock = 0;
          strtag_id_flag.GN_USstock = 0;
        }
        
      });
      M.controller.add('stockType_HY_USstock', function (ev) {
        ev.preventDefault();
        if(strtag_id_flag.HY_USstock == 1){
          $("#HY_USstock").hide();
          strtag_id_flag.HY_USstock = 0;
        }else{
          $("#HY_USstock").show();
          $("#HY_Astock").hide();
          $("#HY_HKstock").hide();
          $("#GN_USstock").hide();
          $("#GN_Astock").hide();
          $("#GN_HKstock").hide();
          strtag_id_flag.HY_USstock = 1;
          strtag_id_flag.HY_Astock = 0;
          strtag_id_flag.HY_HKstock = 0;
          strtag_id_flag.GN_USstock = 0;
          strtag_id_flag.GN_Astock = 0;
          strtag_id_flag.GN_HKstock = 0;
        }
      });

      //GN
      M.controller.add('stockType_GN_Astock', function (ev) {
        ev.preventDefault();
        if(strtag_id_flag.GN_Astock == 1){
          $("#GN_Astock").hide();
          strtag_id_flag.GN_Astock = 0;
        }else{
          $("#HY_USstock").hide();
          $("#HY_Astock").hide();
          $("#HY_HKstock").hide();
          $("#GN_USstock").hide();
          $("#GN_Astock").show();
          $("#GN_HKstock").hide();
          strtag_id_flag.HY_USstock = 0;
          strtag_id_flag.HY_Astock = 0;
          strtag_id_flag.HY_HKstock = 0;
          strtag_id_flag.GN_USstock = 0;
          strtag_id_flag.GN_Astock = 1;
          strtag_id_flag.GN_HKstock = 0;
        }
      });
      M.controller.add('stockType_GN_HKstock', function (ev) {
        ev.preventDefault();
        if(strtag_id_flag.GN_HKstock == 1){
          $("#GN_HKstock").hide();
          strtag_id_flag.GN_HKstock = 0;
        }else{
          $("#HY_USstock").hide();
          $("#HY_Astock").hide();
          $("#HY_HKstock").hide();
          $("#GN_USstock").hide();
          $("#GN_Astock").hide();
          $("#GN_HKstock").show();
          strtag_id_flag.HY_USstock = 0;
          strtag_id_flag.HY_Astock = 0;
          strtag_id_flag.HY_HKstock = 0;
          strtag_id_flag.GN_USstock = 0;
          strtag_id_flag.GN_Astock = 0;
          strtag_id_flag.GN_HKstock = 1;
        }
      });
      M.controller.add('stockType_GN_USstock', function (ev) {
        ev.preventDefault();
        if(strtag_id_flag.GN_USstock == 1){
          $("#GN_USstock").hide();
          strtag_id_flag.GN_USstock = 0;
        }else{
          $("#HY_USstock").hide();
          $("#HY_Astock").hide();
          $("#HY_HKstock").hide();
          $("#GN_USstock").show();
          $("#GN_Astock").hide();
          $("#GN_HKstock").hide();
          strtag_id_flag.HY_USstock = 0;
          strtag_id_flag.HY_Astock = 0;
          strtag_id_flag.HY_HKstock = 0;
          strtag_id_flag.GN_USstock = 1;
          strtag_id_flag.GN_Astock = 0;
          strtag_id_flag.GN_HKstock = 0;
        }
      });


      M.controller.add('ignoreType', function (ev) {
        ev.preventDefault();

        var $parent = $(this).parent();
        $parent.find('.btn-primary').removeClass('btn-primary').addClass('btn-default');
        $(this).addClass('btn-primary').removeClass('btn-default');
         
        //获取保持前状态
        if(saveData.id){
          $.post(CONST.baseUrl + "NewsInfo/update", {
            id: saveData.id,
            state : 5
          }, 'json').done(function (res) {
              if (res.code != 0) {
                return alert('操作失败，请稍后再试~');
              }else{
                alert('忽略成功~');
                return window.location.reload(true);
              } 

            }).fail(function () {
              alert('操作失败，请稍后再试~');
            });
        }else{
          alert('操作失败，请稍后再试~');
        }
      });

      M.controller.add('saveType', function (ev) {
        ev.preventDefault();

        var $parent = $(this).parent();
        $parent.find('.btn-primary').removeClass('btn-primary').addClass('btn-default');
        $(this).addClass('btn-primary').removeClass('btn-default');
         
         //分类
        saveData.type = parseInt($(".col-sm-11 [name='type']").filter(":checked").attr('value'));

        //标题
        saveData.title= $(".col-sm-11 [name='title']").val();
        //来源
        saveData.source= $(".col-sm-11 [name='source']").val();
        //内容
        //saveData.content= $(".col-sm-11 [name='content']").val();
        // saveData.content= $(".note-editable").html();
        saveData.content= editor.getContent();
        //zh
        saveDataTemp.strbar_id_ZH = "";
        $(".stock-bar input[name='strbar_id_ZH']:checked").each(function (){
          //saveDataTemp.strbar_id_ZH += this.value.substr(1, this.value.length - 1) + "/";
          saveDataTemp.strbar_id_ZH += this.value + "/";
        });
        if(saveDataTemp.strbar_id_ZH != ""){
          saveDataTemp.strbar_id_ZH = saveDataTemp.strbar_id_ZH.substr(0, saveDataTemp.strbar_id_ZH.length - 1);
        }

        //个股关联
        if($(".col-sm-11 [name='strbar_id']").val() == "" && saveDataTemp.strbar_id_ZH != ""){
          saveData.strbar_id = saveDataTemp.strbar_id_ZH;
        }else if($(".col-sm-11 [name='strbar_id']").val() != "" && saveDataTemp.strbar_id_ZH == ""){
          saveData.strbar_id = $(".col-sm-11 [name='strbar_id']").val();
        }else if($(".col-sm-11 [name='strbar_id']").val() != "" && saveDataTemp.strbar_id_ZH != ""){
          saveData.strbar_id = saveDataTemp.strbar_id_ZH + ";" + $(".col-sm-11 [name='strbar_id']").val();
        }else{
          saveData.strbar_id = "";
        }
        //saveData.strbar_id.replace(",", "_");

        //精华设置
        saveData.index_recom_state = $(".col-sm-11 input[name='index_recom_state']:checked").length == 0 ? 0 : 1;
        saveData.essential_state = $(".col-sm-11 input[name='essential_state']:checked").length == 0 ? 0 : 1;
        saveData.sticky_state = $(".col-sm-11 input[name='sticky_state']:checked").length == 0 ? 0 : 1;

        //行业标签
        saveData.strtag_id = "";
        $(".stock-tag input[name='strtag_id']:checked").each(function (){
          saveData.strtag_id += this.value + "_";
        });
        saveData.strtag_id = saveData.strtag_id.substr(0, saveData.strtag_id.length - 1);

        //获取保持前状态
        var param = {id: saveData.id};
        if(saveData.id){
          $.getJSON(CONST.baseUrl + 'NewsInfo/get', param).done(function (res) {
            if (res.code !== 0) {
              //return tips('服务器繁忙，请稍后再试~~');
              alert("服务器繁忙，请稍后再试~~");
            } 
            //alert("test");
            var getdataList = res.data.list;

            if (!getdataList.length) {
              //return tips('没有数据哦~~~');
              alert("获取资讯暑假失败");
            }

            saveData.state = getdataList[0]['state'];

          }).fail(function () {
            //tips('服务器繁忙，请稍后再试~~');
            alert("服务器繁忙，请稍后再试~~");
          }).always(function () {
              $.post(CONST.baseUrl + "NewsInfo/update", {
                id: saveData.id,
                type : saveData.type,
                title : saveData.title,
                sticky_state : saveData.sticky_state,
                essential_state : saveData.essential_state,
                index_recom_state : saveData.index_recom_state,
                source : saveData.source,
                state : (saveData.state == 1 || saveData.state == 4) ? 4 : 2, 
                strtag_id : saveData.strtag_id,
                strbar_id : saveData.strbar_id,
                content : saveData.content
              }, 'json').done(function (res) {
                  if (res.code == 20400) {
                    return alert('没有更新数据，请修改数据再保存~');
                  }else if (res.code !== 0) {
                    return alert('操作失败，请稍后再试~');
                  }else{
                    saveDataTemp.updateTag = 1;
                    return alert('保存成功~');
                    //return window.location.reload(true);
                  } 

                }).fail(function () {
                  alert('操作失败，请稍后再试~');
                });
          });
        }else{
          addNews("add");
        }

      });


      M.controller.add('releaseType', function (ev) {
        ev.preventDefault();

        var $parent = $(this).parent();
        $parent.find('.btn-primary').removeClass('btn-primary').addClass('btn-default');
        $(this).addClass('btn-primary').removeClass('btn-default');
         
         //分类
        saveData.type = parseInt($(".col-sm-11 [name='type']").filter(":checked").attr('value'));

        //标题
        saveData.title= $(".col-sm-11 [name='title']").val();
        //来源
        saveData.source= $(".col-sm-11 [name='source']").val();
        //内容
        //saveData.content= $(".col-sm-11 [name='content']").val();
        // saveData.content= $(".note-editable").html();
        saveData.content= editor.getContent();
        //zh
        saveDataTemp.strbar_id_ZH = "";
        $(".stock-bar input[name='strbar_id_ZH']:checked").each(function (){
          //saveDataTemp.strbar_id_ZH += this.value.substr(1, this.value.length - 1) + "/";
          saveDataTemp.strbar_id_ZH += this.value + "/";
        });
        if(saveDataTemp.strbar_id_ZH != ""){
          saveDataTemp.strbar_id_ZH = saveDataTemp.strbar_id_ZH.substr(0, saveDataTemp.strbar_id_ZH.length - 1);
        }

        //个股关联
        if($(".col-sm-11 [name='strbar_id']").val() == "" && saveDataTemp.strbar_id_ZH != ""){
          saveData.strbar_id = saveDataTemp.strbar_id_ZH;
        }else if($(".col-sm-11 [name='strbar_id']").val() != "" && saveDataTemp.strbar_id_ZH == ""){
          saveData.strbar_id = $(".col-sm-11 [name='strbar_id']").val();
        }else if($(".col-sm-11 [name='strbar_id']").val() != "" && saveDataTemp.strbar_id_ZH != ""){
          saveData.strbar_id = saveDataTemp.strbar_id_ZH + ";" + $(".col-sm-11 [name='strbar_id']").val();
        }else{
          saveData.strbar_id = "";
        }

        var len = saveData.strbar_id.length;
        if(saveData.strbar_id.substr(len - 1,len) == "/"){
          saveData.strbar_id = saveData.strbar_id.substr(0, len - 1);
        }
        //saveData.strbar_id.replace(",", "_");

        //精华设置
        saveData.index_recom_state = $(".col-sm-11 input[name='index_recom_state']:checked").length == 0 ? 0 : 1;
        saveData.essential_state = $(".col-sm-11 input[name='essential_state']:checked").length == 0 ? 0 : 1;
        saveData.sticky_state = $(".col-sm-11 input[name='sticky_state']:checked").length == 0 ? 0 : 1;

        //行业标签
        saveData.strtag_id = "";
        $(".stock-tag input[name='strtag_id']:checked").each(function (){
          saveData.strtag_id += this.value + "_";
        });
        saveData.strtag_id = saveData.strtag_id.substr(0, saveData.strtag_id.length - 1);

        if(saveData.id){
          releaseNews();
        }else{
          addNews("release");
        }
      });

    
      M.controller.add('allselect', function (ev) {
        ev.preventDefault();

        var $is_select = $("#mod_info input[name='is_select']");
        if(allSelectTag == 0){
          for(var i = 0; i < $is_select.length; i++){
            $is_select[i].checked = true;
          }
          allSelectTag = 1;
          $(".tile-footer button[data-click='allselect']").text("取消全选");
        }else{
          for(var i = 0; i < $is_select.length; i++){
            $is_select[i].checked = false;
          }
          allSelectTag = 0;
          $(".tile-footer button[data-click='allselect']").text("全选");
        }
        
        
      });

      M.controller.add('allignoe', function (ev) {
        ev.preventDefault();

        var $is_select = $("#mod_info input[name='is_select']");
        var strid = "";
        for(var i = 0; i < $is_select.length; i++){
          if($is_select[i].checked == true){
            strid += $is_select[i].id + "_";
          }
        }
        if(strid == ""){
          alert("你还没有勾选要忽略的资讯新闻~");
        }else{
          strid = strid.substr(0, strid.length-1);

          $.getJSON(CONST.baseUrl + 'NewsInfo/ignoreBanch',
            {
              id: strid
            }).done(function (res) {
              if (res.code === 0 && res.data.list) {
                if (res.code !== 0) {
                  return alert('操作失败，请稍后再试~');
                }else{
                  alert("批量忽略成功~");
                  return window.location.reload(true);
                } 
              } else {
                alert('操作失败，请稍后再试~');
              }
              
            }).fail(function () {
              alert('服务器繁忙');
            });

        }
        
      });

      M.controller.add('searchType', function (ev) {
        ev.preventDefault();

        queryConfig.curpage = 1;

        searchNews();
        
      });

      M.controller.add('selectType', function (ev) {
        var $parent = $(this).parent();
        $parent.find('.btn-primary').removeClass('btn-primary').addClass('btn-default');
        $(this).addClass('btn-primary').removeClass('btn-default');

        queryConfig.state = $(this).data('value');
        queryConfig.curpage = 1;
        loadData();
      })
      .add({
        ignore: function (ev) {
          ev.preventDefault();

          var $this = $(this);
          var id = $this.data('id');

          var tagVal = $(".table-options button[class='btn btn-primary']").attr("data-value");
          if(tagVal == "1"){
            tagVal = "3";
          }else if(tagVal == "5"){
            tagVal = "2";
          }else{
            tagVal = "5";
          }

          $.post(CONST.baseUrl + 'NewsInfo/update', {
            id: id,
            state: tagVal
          }, 'json').done(function (res) {
            if (res.code !== 0) {
              return alert('操作失败，请稍后再试~');
            } 

            var $tr = $this.parent().closest('tr');

            if (!$tr.siblings().size()) {
              loadData();
            } else {
              $tr.remove();
              loadData(); 
            }

          }).fail(function () {
            alert('操作失败，请稍后再试~');
          });

        },

        edit: function (ev) {
          ev.preventDefault();
          

          var $modal = $('#edit_modal'),
              idx = $(this).parent().closest('tr').index(),
              data = dataList[idx],
              editProp = {
                title: 'text',
                source: 'text',
                type: 'radio',
                index_recom_state: 'checkbox',
                sticky_state: 'checkbox',
                essential_state: 'checkbox',
                content: 'div'
                //content: 'textarea'
              };


          if(idx == -1){
            data = newsData;
            $("#addurl").show();
          }else{
            $("#addurl").hide();
          }    
          //if(saveDataTemp.updateTag == 0){
            saveData = data;
          //}    



          var index = saveData.strbar_id.indexOf(";");
          var strbar_id_Temp = saveData.strbar_id;
          var reg = /^[0-9]+$/;
          if(index > 0){
            saveDataTemp.strbar_id = strbar_id_Temp.substr(index+1, strbar_id_Temp.length);
            saveDataTemp.strbar_id_ZH = strbar_id_Temp.substr(0, index);
          //}else if(strbar_id_Temp.length < 6 || ( strbar_id_Temp.length >= 6  && strbar_id_Temp.substr(0, 6).indexOf("/") > 0)){
          }else if(strbar_id_Temp.length == 3 && reg.test(strbar_id_Temp) || ( strbar_id_Temp.length > 3  && strbar_id_Temp.substr(0, 6).indexOf("/") > 0 && reg.test(strbar_id_Temp.replace(/\//g,"")))){
            saveDataTemp.strbar_id = "";
            saveDataTemp.strbar_id_ZH = strbar_id_Temp;
          }else{
            saveDataTemp.strbar_id = strbar_id_Temp;
            saveDataTemp.strbar_id_ZH = "";
          }
          
          if(strbar_id_Temp == "" && saveData.type == 2){
            saveDataTemp.strbar_id = saveData.code;
            //console.log("gong gao");
          }

          _.each(editProp, function (type, prop) {
            var $target = $modal.find('[name=' + prop + ']'),
                val = data[prop];

            if (type === 'text' || type === "textarea") {
              $target.val(val);
            } else if (type === 'radio') {
              $target.click();
            } else if (type === 'div') {
            //  $target.html(val.replace("<!--", ""));
              var valTemp = val.replace("<!--", "");
              valTemp = valTemp.replace(/[\r\n]/g, "#return#");
              $target.html(valTemp);
              // var htmlVal = $target.text();
              // $target.html(htmlVal);
              // $(".note-editable").html(htmlVal);  
            } else if (type === 'checkbox') {
              if (+val) {
                $target.click();
              } 
            }

          });


        //编辑框
          // $('#edit_content').summernote({
          //   toolbar: [
          //     //['style', ['style']], // no style button
          //     ['style', ['bold', 'underline', 'clear']],
          //     //['style', ['bold', 'italic', 'underline', 'clear']],
          //     // ['fontsize', ['fontsize']],
          //     // ['color', ['color']],
          //     // ['para', ['ul', 'ol', 'paragraph']],
          //     // ['height', ['height']]
          //     //['insert', ['picture', 'link']], // no insert buttons
          //     //['table', ['table']], // no table button
          //     //['help', ['help']] //no help button
          //   ],
          //   height: 400   //set editable area's height
          // });
  
          //$('#edit_content').html($(".col-sm-11 [name='content']").val());
          // $(".note-codable").attr("style","display:none");
          //var addbr = $(".note-editor").html().replace('</textarea>','</textarea><br>');
          //$(".note-editor").html(addbr);

          //跨域请求搜索联想接口
          function random () {
              return String(Math.random()).slice(2, 10);    
          }
          var iframeId = 'cross-domain-' + random();
          var $imageIframe = $('<iframe id="' + iframeId + '" name="' + iframeId + '" src="http://www.richba.com/iframe.html"></iframe>');

          $('body').append($imageIframe);

          $('#edit_strbar_id').on('input', function (ev) {
            ev.preventDefault();
            var key = $.trim($(this).val());
            key = key.substr(key.lastIndexOf("/")+1,key.length);
            if(key != '') {
              // var data = res.data;
              // var $html = buildHTML(data);
              search(key, iframeId);
              
            } 
            else {
              reset();
            }
          });

          //新编辑框
          var selector = $('#edit_content');
          editor = selector.simpleEditor();


          $(document).mouseup(function(e){
            var resultList = $('#search_result_list'),
                searchArea = $('#top_search');
            if(!resultList.is(e.target) && resultList.has(e.target).length === 0 & !searchArea.is(e.target) && searchArea.has(e.target).length === 0){
               reset();
            }
          });


          //获取标签数据
          var tagType, subtype, name, taghtml, code, strclass;

          $.getJSON(CONST.baseUrl + 'Stock_bar/get').done(function (res){
            if (res.code !== 0){
              alert(res.code);
           //   $.('.stock-tag').html();
            }else if (res.data){
              tagList = res.data.list;
              if(!tagList.length){
                return tips('没有标签数据哦~~~');
              }

              var barAstock_ZH = '<h5>沪深：</h5>',
                  barHKstock_ZH = '<h5>港股：</h5>',
                  barUSstock_ZH = '<h5>美股：</h5>';
              var count = tagList.length;
              strbar_id_Temp = '/' + saveDataTemp.strbar_id_ZH + '/';

              for(var i = 0; i < count; i++){
                strclass = tagList[i].class;
                mycode = tagList[i].code;
                name = tagList[i].name;
                id = tagList[i].id;
                if(strclass === "21000"){
                  if(strbar_id_Temp.indexOf("/"+mycode+"/") >= 0){
                    barAstock_ZH+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" checked="checked" value="'+mycode+'" name="strbar_id_ZH" id="ZH_opt_'+mycode+'"><label for="ZH_opt_'+mycode+'">'+name+'</label></div>'
                  }else{
                    barAstock_ZH+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" value="'+mycode+'" name="strbar_id_ZH" id="ZH_opt_'+mycode+'"><label for="ZH_opt_'+mycode+'">'+name+'</label></div>'
                  }
                }//if
                if(strclass === "22000"){
                  if(strbar_id_Temp.indexOf("/"+mycode+"/") >= 0){
                    barHKstock_ZH+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" checked="checked" value="'+mycode+'" name="strbar_id_ZH" id="ZH_opt_'+mycode+'"><label for="ZH_opt_'+mycode+'">'+name+'</label></div>'
                  }else{
                    barHKstock_ZH+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" value="'+mycode+'" name="strbar_id_ZH" id="ZH_opt_'+mycode+'"><label for="ZH_opt_'+mycode+'">'+name+'</label></div>'
                  }
                }//if
                if(strclass === "23000"){
                  if(strbar_id_Temp.indexOf("/"+mycode+"/") >= 0){
                    barUSstock_ZH+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" checked="checked" value="'+mycode+'" name="strbar_id_ZH" id="ZH_opt_'+mycode+'"><label for="ZH_opt_'+mycode+'">'+name+'</label></div>'
                  }else{
                    barUSstock_ZH+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" value="'+mycode+'" name="strbar_id_ZH" id="ZH_opt_'+mycode+'"><label for="ZH_opt_'+mycode+'">'+name+'</label></div>'
                  }
                }//if


              } //for   

              $(".stock-bar").html(barAstock_ZH+barHKstock_ZH+barUSstock_ZH);
             
            }
          }).fail(function (){
            return tips('服务器繁忙，请稍后再试~~~');
          });


          //获取标签数据
          $.getJSON(CONST.baseUrl + 'Tag/get', queryConfig).done(function (res){
            if (res.code !== 0){
              alert(res.code);
           //   $.('.stock-tag').html();
            }else if (res.data){
              tagList = res.data.list;
              if(!tagList.length){
                return tips('没有标签数据哦~~~');
              }

              var count = tagList.length;
              //var tagType, subtype, name, taghtml;
              var numHY_Astock = 0, numHY_HKstock = 0, numHY_USstock = 0;
              var numGN_Astock = 0, numGN_HKstock = 0, numGN_USstock = 0;
              //<button type="button" data-click="saveType" data-value="0"  class="btn btn-default">保存</button>
              var tagAstock_Head = '<button type="button" data-click="stockType_HY_Astock" data-value="0"  class="btn btn-default">A股行业</button><button type="button" data-click="stockType_HY_HKstock" data-value="0"  class="btn btn-default">港股行业</button><button type="button" data-click="stockType_HY_USstock" data-value="0"  class="btn btn-default">美股行业</button><button type="button" data-click="stockType_GN_Astock" data-value="0"  class="btn btn-default">A股概念</button><button type="button" data-click="stockType_GN_HKstock" data-value="0"  class="btn btn-default">港股概念</button><button type="button" data-click="stockType_GN_USstock" data-value="0"  class="btn btn-default">美股概念</button>'
                  tagAstock_HY = '<div id="HY_Astock" style="display:none;">', 
                  tagHKstock_HY = '<div id="HY_HKstock" style="display:none;">',  
                  tagUSstock_HY = '<div id="HY_USstock" style="display:none;">',
                  tagAstock_GN = '<div id="GN_Astock" style="display:none;">', 
                  tagHKstock_GN = '<div id="GN_HKstock" style="display:none;">',  
                  tagUSstock_GN = '<div id="GN_USstock" style="display:none;">';
              for(var i = 0; i < count; i++){
                tagType = tagList[i].type;
                subtype = tagList[i].subtype;
                name = tagList[i].name;
                id = tagList[i].id;
                strtag_id_Temp = "_"+saveData.strtag_id+"_";
                //hangye
                if(tagType === "1" && subtype ==="1"){
                  numHY_Astock++;
                  if(strtag_id_Temp.indexOf("_"+id+"_") >= 0){
                    tagAstock_HY+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" checked="checked" value="'+id+'" name="strtag_id" id="HY_opt_1_'+numHY_Astock+'"><label for="HY_opt_1_'+numHY_Astock+'">'+name+'</label></div>'
                  }else{
                    tagAstock_HY+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" value="'+id+'" name="strtag_id" id="HY_opt_1_'+numHY_Astock+'"><label for="HY_opt_1_'+numHY_Astock+'">'+name+'</label></div>'
                  }
                }
                if(tagType === "1" && subtype === "2"){
                  numHY_HKstock++;
                  if(strtag_id_Temp.indexOf("_"+id+"_") >= 0){
                    tagHKstock_HY+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" checked="checked" value="'+id+'" name="strtag_id" id="HY_opt_2_'+numHY_HKstock+'"><label for="HY_opt_2_'+numHY_HKstock+'">'+name+'</label></div>'
                  }else{
                    tagHKstock_HY+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" value="'+id+'" name="strtag_id" id="HY_opt_2_'+numHY_HKstock+'"><label for="HY_opt_2_'+numHY_HKstock+'">'+name+'</label></div>'
                  }
                }
                if(tagType === "1" && subtype === "3"){
                  numHY_USstock++;
                  if(strtag_id_Temp.indexOf("_"+id+"_") >= 0){
                    tagUSstock_HY+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" checked="checked" value="'+id+'" name="strtag_id" id="HY_opt_3_'+numHY_USstock+'"><label for="HY_opt_3_'+numHY_USstock+'">'+name+'</label></div>'
                  }else{
                    tagUSstock_HY+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" value="'+id+'" name="strtag_id" id="HY_opt_3_'+numHY_USstock+'"><label for="HY_opt_3_'+numHY_USstock+'">'+name+'</label></div>'
                  }
                }

                //gainian
                if(tagType === "2" && subtype === "1"){
                  numGN_Astock++;
                  if(strtag_id_Temp.indexOf("_"+id+"_") >= 0){
                    tagAstock_GN+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" checked="checked" value="'+id+'" name="strtag_id" id="GN_opt_1_'+numGN_Astock+'"><label for="GN_opt_1_'+numGN_Astock+'">'+name+'</label></div>'
                  }else{
                    tagAstock_GN+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" value="'+id+'" name="strtag_id" id="GN_opt_1_'+numGN_Astock+'"><label for="GN_opt_1_'+numGN_Astock+'">'+name+'</label></div>'
                  }
                }
                if(tagType === "2" && subtype === "2"){
                  numGN_HKstock++;
                  if(strtag_id_Temp.indexOf("_"+id+"_") >= 0){
                    tagHKstock_GN+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" checked="checked" value="'+id+'" name="strtag_id" id="GN_opt_2_'+numGN_HKstock+'"><label for="GN_opt_2_'+numGN_HKstock+'">'+name+'</label></div>' 
                  }else{
                    tagHKstock_GN+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" value="'+id+'" name="strtag_id" id="GN_opt_2_'+numGN_HKstock+'"><label for="GN_opt_2_'+numGN_HKstock+'">'+name+'</label></div>'
                  }
                }
                if(tagType === "2" && subtype === "3"){
                  numGN_USstock++;
                  if(strtag_id_Temp.indexOf("_"+id+"_") >= 0){
                    tagUSstock_GN+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" checked="checked" value="'+id+'" name="strtag_id" id="GN_opt_3_'+numGN_USstock+'"><label for="GN_opt_3_'+numGN_USstock+'">'+name+'</label></div>'
                  }else{
                    tagUSstock_GN+='<div class="checkbox check-transparent" style="display:inline-block;"><input type="checkbox" value="'+id+'" name="strtag_id" id="GN_opt_3_'+numGN_USstock+'"><label for="GN_opt_3_'+numGN_USstock+'">'+name+'</label></div>'
                  }
                }
                
              }

              //链接
              $("#modalDialogLabel a").attr("href",saveData.url);

              //type
              $(".col-sm-11 [value='"+ saveData.type +"']").prop("checked", true);

              //
              $(".col-sm-11 input[name='strbar_id']").val(saveDataTemp.strbar_id);

              //精华设置
              if(saveData.index_recom_state == "1"){
                $(".col-sm-11 input[name='index_recom_state']").prop("checked", true);
              }else{
                $(".col-sm-11 input[name='index_recom_state']").prop("checked", false);
              }
              if(saveData.essential_state == "1"){
                $(".col-sm-11 input[name='essential_state']").prop("checked", true);
              }else{
                $(".col-sm-11 input[name='essential_state']").prop("checked", false);
              }
              if(saveData.sticky_state == "1"){
                $(".col-sm-11 input[name='sticky_state']").prop("checked", true);
              }else{
                $(".col-sm-11 input[name='sticky_state']").prop("checked", false);
              }

              $(".stock-tag").html(tagAstock_Head+tagAstock_HY+'</div>'+tagHKstock_HY+'</div>'+tagUSstock_HY+'</div>'+tagAstock_GN+'</div>'+tagHKstock_GN+'</div>'+tagUSstock_GN+'</div><br><br><br>');
            }
          }).fail(function (){
            return tips('服务器繁忙，请稍后再试~~~');
          }).always(function () {
            M.loader.hide();
          });

          $modal.modal();
        },


        publish: function (ev) {
          ev.preventDefault();

          var id = $(this).data('id');
          console.log(id);  
        }
      });

      loadData();

    });

  function outoInput () {
    //var value = $("#search_result_list").val();

    $("#search_result_list").val("哈哈哈哈");
  }

  function tips (text) {
      $('.pagination').html('');
      $container.html('<h4 style="text-align:center;line-height:100px;">' + text + '</h4>');
  }

  function buildHTML (data) {
    return Template.extend['stock-search']({list: data});
  }

  function reset() {
    $('#search_result_list').addClass('hide');
    searchKey = '';
  }

  function addNews (val) {
    var url = $(".col-sm-11 [name='url']").val();
    if(!url.length){
        alert('URL不能为空~');
    }else{
        $.post(CONST.baseUrl + "NewsInfo/add", {
          type : saveData.type,
          title : saveData.title,
          sticky_state : saveData.sticky_state,
          essential_state : saveData.essential_state,
          index_recom_state : saveData.index_recom_state,
          source : saveData.source,
          state : 2, 
          strtag_id : saveData.strtag_id,
          strbar_id : saveData.strbar_id,
          content : saveData.content,
          url : $(".col-sm-11 [name='url']").val()
        }, 'json').done(function (res) {
            if (res.code == 20400) {
              return alert('没有更新数据，请修改数据再保存~');
            }else if (res.code !== 0) {
              return alert('操作失败，请稍后再试~');
            }else{
              saveDataTemp.updateTag = 1;
              saveData.id = res.data.list.id;
              if(val == "release"){
                 releaseNews();
              }else{
                 return alert('保存成功~');
                 //return window.location.reload(true);
              }
            } 

          }).fail(function () {
            alert('操作失败，请稍后再试~');
          });
    }
  }

  function releaseNews () {
    $.post(CONST.baseUrl + 'NewsInfo/release', {
          id: saveData.id,
          type : saveData.type,
          title : saveData.title,
          sticky_state : saveData.sticky_state,
          essential_state : saveData.essential_state,
          index_recom_state : saveData.index_recom_state,
          source : saveData.source,
          strtag_id : saveData.strtag_id,
          strbar_id : saveData.strbar_id,
          content : saveData.content
      }, 'json').done(function (res) {
          if (res.code == 20400) {
              return alert('没有更新数据，请修改数据再发布~');
          }else if (res.code !== 0) {
            return alert('操作失败，请稍后再试~');
          }else{
            saveDataTemp.updateTag = 1;
            alert('发布成功~');
            return window.location.reload(true);
          }
        }).fail(function () {
          alert('操作失败，请稍后再试~');
        });
  }

  function getInitBar (val) {

    var stockTagAll = "", stockTagHY = "";    
    $.getJSON(CONST.baseUrl + 'StockTagInit/getStockTag',
      {
        codes: val
      }).done(function (res) {
        if (res.code === 0 && res.data.list) {
            var stockTag = res.data.list;
            var count = stockTag.length;
            for(var i = 0; i < count; i++){
              stockTagHY += stockTag[i].hy_tag+"_";
              stockTagSplit = stockTag[i].gn_tag.split("_");
              var countSplit = stockTagSplit.length;
              for (var j = 0; j < countSplit; j++) {
                if(stockTagAll.indexOf(stockTagSplit[j]) < 0){
                  stockTagAll += stockTagSplit[j]+"_";
                }
              }
            }
        } else {
          alert('操作失败，请稍后再试~');
        }

        //重新设置股吧关联
        //行业
        stockTagHYTemp = (stockTagHY.substr(0, stockTagHY.length - 1)).split("_");
        $("#HY_Astock input[type='checkbox']").prop("checked", false);
        $("#HY_HKstock input[type='checkbox']").prop("checked", false);
        $("#HY_USstock input[type='checkbox']").prop("checked", false);
        for(var i = 0; i < stockTagHYTemp.length; i++){
          $("#HY_Astock input[value='"+stockTagHYTemp[i]+"']").prop("checked", true);
          $("#HY_HKstock input[value='"+stockTagHYTemp[i]+"']").prop("checked", true);
          $("#HY_USstock input[value='"+stockTagHYTemp[i]+"']").prop("checked", true);
        }

        //概念
        stockTagAllTemp = (stockTagAll.substr(0, stockTagAll.length - 1)).split("_");
        $("#GN_Astock input[type='checkbox']").prop("checked", false);
        $("#GN_HKstock input[type='checkbox']").prop("checked", false);
        $("#GN_USstock input[type='checkbox']").prop("checked", false);
        for(var i = 0; i < stockTagAllTemp.length; i++){
          $("#GN_Astock input[value='"+stockTagAllTemp[i]+"']").prop("checked", true);
          $("#GN_HKstock input[value='"+stockTagAllTemp[i]+"']").prop("checked", true);
          $("#GN_USstock input[value='"+stockTagAllTemp[i]+"']").prop("checked", true);
        }
        
      }).fail(function () {
        alert('服务器繁忙');
    });
  }


  function search (key, iframeId) {
    if(!key) return;

    searchKey = key;

    var getUrl = 'http://www.richba.com/index.php/Home/Search/sug';
    var data = {
      key: encodeURIComponent(key),
      count: 5
    };

    var ifmJquery = document.getElementById(iframeId).contentWindow.$;
    ifmJquery.ajax({
      url: getUrl,
      type: 'GET',
      data: data,
    }).done(function (resStr) {
          var res = JSON.parse(resStr);
          if (res.code === 0 && res.data.list.length > 0) {
            var searchData = res.data.list;
            var count = searchData.length, $html = '';
            for(var i = 0; i < count; i++){
              $html += '<li class="active">'+searchData[i].name+'('+searchData[i].code+')</li>';
            }
            $('#search_result_list').removeClass('hide').html($html);

            $("#search_result_list li").on('mouseover',function (e) {
                  $("li[class='active']").removeAttr("class");
                  $(this).addClass("active"); 
            });

            $("#search_result_list li").on('click',function (e) {
                  var strvalueTemp = $(this).html();
                  var strvalue = $('#edit_strbar_id').val();
                  var tag = strvalue.lastIndexOf("/");

                  strvalueTemp = strvalueTemp.substr(strvalueTemp.indexOf("(")+1, (strvalueTemp.indexOf(")") - strvalueTemp.indexOf("(") - 1));

                  if(strvalue.indexOf(strvalueTemp+"/") == -1){ //去重&&
                    if(tag > 0){
                      $('#edit_strbar_id').val(strvalue.substr(0, tag+1)+strvalueTemp+"/");
                      $("li[class='active']").removeAttr("class");
                    }else{
                      $('#edit_strbar_id').val(strvalueTemp+"/");
                      $("li[class='active']").removeAttr("class");
                    }
                  }

                  console.log(searchData[0].ucode);
                  //关联刷新
                  //getInitBar($('#edit_strbar_id').val());
                  getInitBar(searchData[0].ucode);
            });
          } else {
            console.log(res.code + ' ' + res.data.list.length)
            console.log(res.msg);
          }

        });
  }


  function searchNews() {
    //标题
      strTitle = $(".search input[name='searchTitle']").val();

      $.post(CONST.baseUrl + 'NewsInfo/search', {  
          title : strTitle,
          state : queryConfig.state,
          ctime : queryConfig.ctime
      }, 'json').done(function (res) {
          if (res.code !== 0) {
            return alert('操作失败，请稍后再试~');
          }else{
         
            dataList = res.data.list;

            if (!dataList.length) {
              return tips('没有数据哦~~~');
            }

            var $pagination = $('.pagination');

            $pagination.pagination({
              items: res.data.count,
              itemsOnPage: queryConfig.pagenum,
              onPageClick: function (page) {
                queryConfig.curpage = page;
                loadData();
              },
              currentPage: queryConfig.curpage
            });

            var tpl = "", tagVal = $(".table-options button[class='btn btn-primary']").attr("data-value");
            if(tagVal == "1"){
              tpl = Handlebars.compile($('#tpl_info_release').html());
            }else if(tagVal == "5"){
              tpl = Handlebars.compile($('#tpl_info_ignore').html());
            }else{
              tpl = Handlebars.compile($('#tpl_info').html());
            }

            dataList.forEach(function (obj, idx) {
              obj.typeName = mapToType[obj.type];
              if(obj.retreat == "1"){
                obj.color = "color:red";
              }else{
                obj.color = "color:white";
              }
            });

            
            $container.html(tpl({
              list: dataList 
            }));
        }  

      }).fail(function () {
        alert('操作失败，请稍后再试~');
      }).always(function () {
        M.loader.hide();
      });

      M.loader.show();
  }


  function loadData () {
    if (!queryConfig.ctime) {
      return ;
    }

    $.getJSON(CONST.baseUrl + 'Admin/getUserid').done(function (res) {
      if (res.code == 20401) {
        alert("请登录后查看数据~~");
        window.location.href="/login.html";
      }else{
        queryConfig.user_id = res.data.user_id;
        if($(".search input[name='searchTitle']").val()){
            searchNews();
        }else{
            $.getJSON(CONST.baseUrl + 'NewsInfo/get', queryConfig).done(function (res) {
              if (res.code == 20401) {
                alert("请登录后查看数据~~");
                window.location.href="/login.html";
              }else if (res.code !== 0) {
                return tips('服务器繁忙，请稍后再试~~');
              } 

              dataList = res.data.list;

              if (!dataList.length) {
                return tips('没有数据哦~~~');
              }

              var $pagination = $('.pagination');

              $pagination.pagination({
                items: res.data.count,
                itemsOnPage: queryConfig.pagenum,
                onPageClick: function (page) {
                  queryConfig.curpage = page;
                  loadData();
                },
                currentPage: queryConfig.curpage
              });


              var tpl = "", tagVal = $(".table-options button[class='btn btn-primary']").attr("data-value");
              if(tagVal == "1"){
                tpl = Handlebars.compile($('#tpl_info_release').html());
              }else if(tagVal == "5"){
                tpl = Handlebars.compile($('#tpl_info_ignore').html());
              }else{
                tpl = Handlebars.compile($('#tpl_info').html());
              }

              //var tpl = Handlebars.compile($('#tpl_info').html());

              dataList.forEach(function (obj, idx) {
                obj.typeName = mapToType[obj.type];
                if(obj.retreat == "1"){
                  obj.color = "color:red";
                }else{
                  obj.color = "color:white";
                }
              });

              $container.html(tpl({
                list: dataList 
              }));

            }).fail(function () {
              tips('服务器繁忙，请稍后再试~~');
            }).always(function () {
              M.loader.hide();
            });
        }//else
        
      }//else
    }).fail(function () {
      tips('服务器繁忙，请稍后再试~~');
    });

    M.loader.show();
  }


}();
      
    </script>
  </body>
</html>
      
